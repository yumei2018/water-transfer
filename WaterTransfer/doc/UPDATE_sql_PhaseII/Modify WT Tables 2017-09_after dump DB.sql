--------------------------------------------------------------------------------
--  DDL for Table WT_CROP_TYPE
--------------------------------------------------------------------------------
DROP TRIGGER WT_CROP_TYPE_PKTRIG;
DROP SEQUENCE WT_CROP_TYPE_PKSEQ;
DROP TABLE WT_CROP_TYPE;

CREATE TABLE WT_CROP_TYPE (
  WT_CROP_TYPE_ID NUMERIC(16,0) PRIMARY KEY
  ,CROP_TYPE VARCHAR2(32 BYTE)
  ,CROP_ETAW NUMBER(4,2)
  ,CROP_DESCRIPTION VARCHAR2(256 BYTE)
);
/

CREATE SEQUENCE WT_CROP_TYPE_PKSEQ  
  START WITH 1
  INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER WT_CROP_TYPE_PKTRIG
BEFORE INSERT
ON WT_CROP_TYPE
FOR EACH ROW
BEGIN
  IF :NEW.WT_CROP_TYPE_ID IS NULL THEN
    SELECT WT_CROP_TYPE_PKSEQ.NEXTVAL INTO :NEW.WT_CROP_TYPE_ID FROM DUAL;
  END IF;
END WT_CROP_TYPE;
/

-- After this, run insert_WT_CROP_TYPE.sql

--------------------------------------------------------------------------------
--  DDL for Table WT_CI_CROPTYPE
--------------------------------------------------------------------------------
DROP TRIGGER WT_CI_CROPTYPE_UPDATETRIG;
DROP TRIGGER WT_CI_CROPTYPE_PKTRIG;
DROP SEQUENCE WT_CI_CROPTYPE_PKSEQ;
DROP TABLE WT_CI_CROPTYPE;

CREATE TABLE WT_CI_CROPTYPE (
  WT_CI_CROPTYPE_ID NUMERIC(16,0) PRIMARY KEY
  ,WT_CROP_IDLING_ID REFERENCES WT_CROP_IDLING(WT_CROP_IDLING_ID)
  ,CROP_WITHOUT_TRANSFER VARCHAR2(32 BYTE)  
  ,CROP_WITH_TRANSFER VARCHAR2(32 BYTE)
  ,PRO_TRANSFER_TOTAL NUMBER(18,2)
  ,CROP_ETAW NUMBER(4,2)
  ,WATER_TRANSFER_AMOUNT NUMBER(18,2)
  ,CREATED_DATE TIMESTAMP(6) DEFAULT SYSTIMESTAMP
  ,CREATED_BY_ID NUMBER(*,0) 	
	,UPDATED_DATE TIMESTAMP(6) DEFAULT SYSTIMESTAMP 
  ,UPDATED_BY_ID NUMBER(*,0)
);
/

CREATE SEQUENCE WT_CI_CROPTYPE_PKSEQ  
  START WITH 1
  INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER WT_CI_CROPTYPE_PKTRIG
BEFORE INSERT
ON WT_CI_CROPTYPE
FOR EACH ROW
BEGIN
  IF :NEW.WT_CI_CROPTYPE_ID IS NULL THEN
    SELECT WT_CI_CROPTYPE_PKSEQ.NEXTVAL INTO :NEW.WT_CI_CROPTYPE_ID FROM DUAL;
  END IF;
  SELECT SYSTIMESTAMP INTO :NEW.CREATED_DATE FROM DUAL;
  SELECT SYSTIMESTAMP INTO :NEW.UPDATED_DATE FROM DUAL;
END WT_CI_CROPTYPE_PKTRIG;
/

CREATE OR REPLACE TRIGGER WT_CI_CROPTYPE_UPDATETRIG 
BEFORE UPDATE
ON WT_CI_CROPTYPE
FOR EACH ROW 
BEGIN 
  SELECT SYSTIMESTAMP INTO :NEW.UPDATED_DATE FROM DUAL; 
END WT_CI_CROPTYPE_UPDATETRIG;
/

--------------------------------------------------------------------------------
--  Modify Table WT_CROP_IDLING
--------------------------------------------------------------------------------
UPDATE WT_CROP_IDLING SET DELIVERED_AMOUNT = null;
ALTER TABLE WT_CROP_IDLING DROP COLUMN DELIVERED_AMOUNT;
ALTER TABLE WT_CROP_IDLING ADD EXPORT_AMOUNT NUMBER(18,2);
ALTER TABLE WT_CROP_IDLING ADD EXPORTED_AMOUNT NUMBER(18,2);
ALTER TABLE WT_CROP_IDLING ADD DELIVERED_AMOUNT NUMBER(18,2);

--------------------------------------------------------------------------------
--  Modify Table WT_RESERVOIR
--------------------------------------------------------------------------------
UPDATE WT_RESERVOIR SET DELIVERED_AMOUNT = null;
ALTER TABLE WT_RESERVOIR DROP COLUMN DELIVERED_AMOUNT;
ALTER TABLE WT_RESERVOIR ADD EXPORT_AMOUNT NUMBER(18,2);
ALTER TABLE WT_RESERVOIR ADD EXPORTED_AMOUNT NUMBER(18,2);
ALTER TABLE WT_RESERVOIR ADD DELIVERED_AMOUNT NUMBER(18,2);


--------------------------------------------------------------------------------
--  Modify Table WT_GROUNDWATER
--------------------------------------------------------------------------------
UPDATE WT_GROUNDWATER SET DELIVERED_AMOUNT = null;
ALTER TABLE WT_GROUNDWATER DROP COLUMN DELIVERED_AMOUNT;
ALTER TABLE WT_GROUNDWATER ADD EXPORT_AMOUNT NUMBER(18,2);
ALTER TABLE WT_GROUNDWATER ADD EXPORTED_AMOUNT NUMBER(18,2);
ALTER TABLE WT_GROUNDWATER ADD DELIVERED_AMOUNT NUMBER(18,2);

--------------------------------------------------------------------------------
--  Modify Table WT_TRANS
--------------------------------------------------------------------------------
ALTER TABLE WT_TRANS ADD CI_REVIEWER VARCHAR2(64);
ALTER TABLE WT_TRANS ADD GS_REVIEWER VARCHAR2(64);
ALTER TABLE WT_TRANS ADD RR_REVIEWER VARCHAR2(64);

--------------------------------------------------------------------------------
--  Remove SUSPEND in Table WT_TRANS related to WT_STATUS_FLAG
--------------------------------------------------------------------------------
Select * from WT_TRANS where WT_STATUS_FLAG_ID = 7;
update WT_TRANS set WT_STATUS_FLAG_ID = 8 where WT_STATUS_FLAG_ID = 7;
-- Remove SUSPEND from table WT_STATUS_FLAG 























